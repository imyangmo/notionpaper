---
import Homepage from '../theme/layouts/Homepage.astro';

import { indexParser } from "../components/Parsers.js"
import { indexFetcher, siteInfoFetcher } from '../components/Fetchers.js'
import { getTitle, setTitle, getDesc, setDesc, setPostList } from '../components/SiteMeta.js'
import { iconMaker } from "../components/Utils";

const siteInfo = await siteInfoFetcher()
setTitle(siteInfo.title[0].plain_text)
setDesc(siteInfo.description[0].plain_text)

const data = await indexFetcher();
const parsedData = indexParser(data.results);

const postList = parsedData.map((item) => {
    return item.id;
});
setPostList(postList)

const siteMeta = {
    siteTitle: getTitle.get(),
    siteDesc: getDesc.get(),
    siteIcon: iconMaker(siteInfo)
}
---

<Homepage siteMeta={ siteMeta } postList={ parsedData }>
</Homepage>