---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

import { DATABASE_ID, NOTION_TOKEN, NOTION_VERSION, NOTION_API_BASE_URL } from "../config"

// const response = await fetch('https://jsonplaceholder.typicode.com/posts');
// const data = await response.json();

const iconMaker = (data) => {
    if(data.icon !== null){
        switch(data.icon.type){
            case 'emoji':
                return 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>' + data.icon.emoji + '</text></svg>'
                break;
            case 'file':
                return data.icon.file.url;
                break;
            case 'external':
                return data.icon.external.url;
                break;
            default:
                break;
        }
    }else{
        return "./favicon.svg";
    }
}


const response = await fetch(NOTION_API_BASE_URL + 'databases/' + DATABASE_ID, {
    method: 'GET',
    headers: {
        'Authorization':'Bearer ' + NOTION_TOKEN,
        'Notion-Version': NOTION_VERSION,
        'Content-Type': 'application/json'
    }
});
const data = await response.json();

// console.log(data.title[0].plain_text);
const site_title = data.title[0].plain_text;
const site_icon = iconMaker(data);
---

<!DOCTYPE html>
<html lang="en-us" class="h-100">
    <head>
        <BaseHead title={ site_title } icon={ site_icon } />
    </head>
    <body class="d-flex flex-column h-100">
        <Header site_title={ site_title } />

        <main class="flex-shrink-0">
            <div class="container">
                <slot title = { site_title } />
            </div>
        </main>

        <Footer />


        <!-- <script async src={{'https://www.googletagmanager.com/gtag/js?id=' + index_object.ga}}></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag(' js', new Date()); gtag('config', '{{index_object.ga}}'); 
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> -->
	</body>
</html>